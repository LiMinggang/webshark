diff --git a/epan/column.c b/epan/column.c
index 6d4fa62..0fe3b3f 100644
--- a/epan/column.c
+++ b/epan/column.c
@@ -807,23 +807,18 @@ get_column_tooltip(const gint col)
     return g_string_free (column_tooltip, FALSE);
 }
 
+WS_DLL_PUBLIC void col_finalize(column_info *cinfo);
+
 void
-build_column_format_array(column_info *cinfo, const gint num_cols, const gboolean reset_fences)
+col_finalize(column_info *cinfo)
 {
   int i;
   col_item_t* col_item;
 
-  /* Build the column format array */
-  col_setup(cinfo, num_cols);
-
   for (i = 0; i < cinfo->num_cols; i++) {
     col_item = &cinfo->columns[i];
-    col_item->col_fmt = get_column_format(i);
-    col_item->col_title = g_strdup(get_column_title(i));
 
     if (col_item->col_fmt == COL_CUSTOM) {
-      col_item->col_custom_fields = g_strdup(get_column_custom_fields(i));
-      col_item->col_custom_occurrence = get_column_custom_occurrence(i);
       if(!dfilter_compile(col_item->col_custom_fields, &col_item->col_custom_dfilter, NULL)) {
         /* XXX: Should we issue a warning? */
         g_free(col_item->col_custom_fields);
@@ -863,9 +858,6 @@ build_column_format_array(column_info *cinfo, const gint num_cols, const gboolea
     else
       col_item->col_buf = (gchar *) g_malloc(sizeof(gchar) * COL_MAX_LEN);
 
-    if(reset_fences)
-      col_item->col_fence = 0;
-
     cinfo->col_expr.col_expr[i] = "";
     cinfo->col_expr.col_expr_val[i] = (gchar *) g_malloc(sizeof(gchar) * COL_MAX_LEN);
   }
@@ -888,6 +880,31 @@ build_column_format_array(column_info *cinfo, const gint num_cols, const gboolea
   }
 }
 
+void
+build_column_format_array(column_info *cinfo, const gint num_cols, const gboolean reset_fences)
+{
+  int i;
+  col_item_t* col_item;
+
+  /* Build the column format array */
+  col_setup(cinfo, num_cols);
+
+  for (i = 0; i < cinfo->num_cols; i++) {
+    col_item = &cinfo->columns[i];
+    col_item->col_fmt = get_column_format(i);
+    col_item->col_title = g_strdup(get_column_title(i));
+    if (col_item->col_fmt == COL_CUSTOM) {
+      col_item->col_custom_fields = g_strdup(get_column_custom_fields(i));
+      col_item->col_custom_occurrence = get_column_custom_occurrence(i);
+    }
+
+    if(reset_fences)
+      col_item->col_fence = 0;
+  }
+
+  col_finalize(cinfo);
+}
+
 /*
  * Editor modelines  -  http://www.wireshark.org/tools/modelines.html
  *
diff --git a/ui/voip_calls.c b/ui/voip_calls.c
index 6cd70d7..f54c6aa 100644
--- a/ui/voip_calls.c
+++ b/ui/voip_calls.c
@@ -65,8 +65,10 @@
 #include "ui/ui_util.h"
 #include "ui/voip_calls.h"
 
-#define DUMP_PTR1(p) printf("#=> %p\n",(void *)p)
-#define DUMP_PTR2(p) printf("==> %p\n",(void *)p)
+#define DUMP_PTR1(p) fprintf(stderr, "#=> %p\n",(void *)p)
+#define DUMP_PTR2(p) fprintf(stderr, "==> %p\n",(void *)p)
+
+#define simple_dialog(...)
 
 const char *voip_call_state_name[8]={
     "",
diff --git a/sharkd.c b/sharkd.c
index 8ca9ff328f..f4870ffb37 100644
--- a/sharkd.c
+++ b/sharkd.c
@@ -258,6 +258,17 @@ sharkd_get_frame_ts(void *data, guint32 frame_num)
   return NULL;
 }
 
+static const char *
+sharkd_get_user_comment(void *data, const frame_data *fd)
+{
+  capture_file *cf = (capture_file *) data;
+
+  if (cf->frames_user_comments)
+     return (const char *) g_tree_lookup(cf->frames_user_comments, fd);
+
+  return NULL;
+}
+
 static epan_t *
 sharkd_epan_new(capture_file *cf)
 {
@@ -267,7 +278,7 @@ sharkd_epan_new(capture_file *cf)
   epan->get_frame_ts = sharkd_get_frame_ts;
   epan->get_interface_name = cap_file_get_interface_name;
   epan->get_interface_description = cap_file_get_interface_description;
-  epan->get_user_comment = NULL;
+  epan->get_user_comment = sharkd_get_user_comment;
 
   return epan;
 }
@@ -781,6 +792,35 @@ sharkd_filter(const char *dftext, guint8 **result)
   return framenum;
 }
 
+static int
+frame_cmp(gconstpointer a, gconstpointer b, gpointer user_data _U_)
+{
+  const frame_data *fdata1 = (const frame_data *) a;
+  const frame_data *fdata2 = (const frame_data *) b;
+
+  return (fdata1->num < fdata2->num) ? -1 :
+    (fdata1->num > fdata2->num) ? 1 :
+    0;
+}
+
+const char *
+sharkd_get_comment(const frame_data *fd)
+{
+  return sharkd_get_user_comment(&cfile, fd);
+}
+
+int
+sharkd_set_comment(frame_data *fd, const gchar *new_comment)
+{
+  if (!cfile.frames_user_comments)
+    cfile.frames_user_comments = g_tree_new_full(frame_cmp, NULL, NULL, g_free);
+
+  fd->flags.has_user_comment = 1;
+  g_tree_replace(cfile.frames_user_comments, fd, g_strdup(new_comment));
+
+  return 0;
+}
+
 #include "version.h"
 const char *sharkd_version(void)
 {
diff --git a/sharkd.h b/sharkd.h
index feef76a795..e0eca3fc1a 100644
--- a/sharkd.h
+++ b/sharkd.h
@@ -34,6 +34,8 @@ int sharkd_retap(void);
 int sharkd_filter(const char *dftext, guint8 **result);
 int sharkd_dissect_columns(int framenum, column_info *cinfo, gboolean dissect_color);
 int sharkd_dissect_request(unsigned int framenum, void (*cb)(packet_info *, proto_tree *, struct epan_column_info *, const GSList *, void *), int dissect_bytes, int dissect_columns, int dissect_tree, void *data);
+const char *sharkd_get_comment(const frame_data *fd);
+int sharkd_set_comment(frame_data *fd, const gchar *new_comment);
 const char *sharkd_version(void);
 
 /* sharkd_daemon.c */
